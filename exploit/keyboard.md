# Solution

## Description of the problem

Yet another task sadly based on a true story.

## Solution

1. Analysing the code, there are three shared preference: ```MY_PREFS_NAME```, ```INFO_PREFS_NAME```, ```GLOBAL_PREFS_NAME```. The most important function here is ```checkForUpdates```, where it first get the ```update.zip``` zip file, and tries to unzip it, if it is successfuly, it will go to ```extractFolder``` function, otherwise, it will depend on if ```debugMode``` is true or not to do the next step.
   Based on this code, I can see it has high possibility that I need to do something to change the ```debugMode``` to ```true``` to list all the entries in the shared perference.

2. Then I need to think about how to make ```debugMode``` in ```com.mobisec.keyboard``` to be true, it is in the shared peference. Accroding to ```extractFolder```, it will extract the files, and then put the file to the custome destination, which will be the ```absolutePath``` of the file. In order to change the global shared peference file, which will be ```/data/data/com.mobisec.keyboard/shared_prefs/GlobalKeyBoardPreference.xml```, I need to replace to my own file. As what I mention above, the ```absolutePath``` of the file will be the destination, so the path for my ```GlobalKeyBoardPreference.xml``` in ```update.zip``` will be ```/data/data/com.mobisec.keyboard/shared_prefs/```. And my ```GlobalKeyBoardPreference.xml``` is shown as below.
   ```
      <?xml version='1.0' encoding='utf-8' standalone='yes' ?>
      <map>
         <int name="crashes" value="188" />
         <boolean name="debugmode" value="true" />
      </map>
   ```

   However, when I used this new ```update.zip```, it shows ```FileNotFound```, which means the path may have mistake. I double checked the path, and noticed that the application is running in the path ```.../com.mobisec.<my_package_name>```. To find the correct place, I add ```../``` one by one to test how many layers ```../``` can help me find the correct place, and it turns out I need four layers, so the final path of the update zip is ```../../../../data/data/com.mobisec.keyboard/shared_prefs/GlobalKeyBoardPreference.xml```

3. I need to make sure, the pargram will also go into the debug mode so that it will print the flag. To do that, I replace it with a broken zip file, I change a random file to ```update1.zip``` and replace it after I go into ```extractFolder``` function, so that it will go to another path. however, I tried several times, I still couldn't get anything, until I noticed that the timer starts so fast, so it replace the normal ```update.zip``` to a broken even before I open the ```GlobalKeyBoardPreference.xml```. To avoid, I set a ```sleep``` to let the previous step finish, and then replace with the broken zip. In the end, I finally got the flag.

## Optional Feedback

I don't get the meaning of the name ```keyboard```.